/*
 * anim.c
 *
 * Created: 30.07.2024 4:31:48
 *  Author: max4d
 */ 
#include "anim.h"

const uint8_t upm_stop_anim[292][4] PROGMEM  = {
	{17,12,17,18},{18,9,18,21},{19,8,19,12},{19,19,19,22},{20,7,20,9},{20,21,20,23},{21,6,21,7},{21,13,21,17},{21,23,21,24},{22,5,22,6},{22,11,22,12},{22,18,22,19},{22,24,22,25},{23,4,23,5},{23,9,23,10},{23,20,23,21},{23,25,23,26},{24,3,24,5},{24,8,24,8},{24,22,24,22},
	{24,25,24,27},{25,3,25,4},{25,8,25,8},{25,22,25,22},{25,26,25,27},{26,3,26,4},{26,7,26,7},{26,23,26,23},{26,26,26,27},{27,2,27,3},{27,7,27,7},{27,23,27,23},{27,27,27,28},{28,2,28,3},{28,6,28,6},{28,24,28,24},{28,27,28,28},{29,2,29,3},{29,6,29,6},{29,24,29,24},
	{29,27,29,28},{30,2,30,3},{30,6,30,6},{30,24,30,24},{30,27,30,28},{31,2,31,3},{31,6,31,6},{31,24,31,24},{31,27,31,28},{32,2,32,3},{32,6,32,6},{32,24,32,24},{32,27,32,28},{33,2,33,3},{33,7,33,7},{33,23,33,23},{33,27,33,28},{34,3,34,4},{34,7,34,7},{34,23,34,23},
	{34,26,34,27},{35,3,35,4},{35,8,35,8},{35,22,35,22},{35,26,35,27},{36,3,36,5},{36,8,36,8},{36,22,36,22},{36,25,36,27},{37,4,37,5},{37,9,37,10},{37,20,37,21},{37,25,37,26},{38,5,38,6},{38,11,38,12},{38,18,38,19},{38,24,38,25},{38,33,38,37},{39,6,39,7},{39,13,39,17},
	{39,23,39,24},{39,31,39,39},{40,7,40,9},{40,21,40,23},{40,29,40,41},{41,8,41,11},{41,19,41,22},{41,28,41,42},{42,9,42,21},{42,28,42,32},{42,38,42,42},{43,12,43,18},{43,27,43,31},{43,34,43,36},{43,39,43,43},{44,27,44,30},{44,32,44,33},{44,37,44,38},{44,40,44,43},{45,26,45,29},
	{45,32,45,32},{45,38,45,38},{45,41,45,44},{46,26,46,29},{46,31,46,31},{46,39,46,39},{46,41,46,44},{47,26,47,29},{47,31,47,31},{47,35,47,35},{47,39,47,39},{47,41,47,44},{48,26,48,29},{48,31,48,31},{48,39,48,39},{48,41,48,44},{49,26,49,29},{49,32,49,32},{49,38,49,38},{49,41,49,44},
	{50,27,50,30},{50,32,50,33},{50,37,50,38},{50,40,50,43},{51,27,51,31},{51,34,51,36},{51,39,51,43},{52,28,52,32},{52,38,52,42},{53,28,53,42},{54,29,54,41},{55,30,55,39},{56,33,56,37},{58,42,58,48},{59,39,59,51},{60,37,60,54},{61,36,61,41},{61,49,61,55},{62,35,62,38},{62,52,62,56},
	{63,34,63,37},{63,53,63,56},{64,33,64,36},{64,54,64,57},{65,32,65,35},{65,55,65,58},{66,32,66,34},{66,56,66,58},{67,31,67,33},{67,57,67,59},{68,31,68,33},{68,57,68,59},{69,31,69,33},{69,44,69,46},{69,57,69,59},{70,30,70,32},{70,42,70,43},{70,47,70,48},{70,58,70,60},{71,30,71,32},
	{71,42,71,42},{71,48,71,48},{71,58,71,60},{72,30,72,32},{72,41,72,41},{72,49,72,49},{72,58,72,60},{73,30,73,32},{73,41,73,41},{73,45,73,45},{73,49,73,49},{73,58,73,60},{74,30,74,32},{74,41,74,41},{74,49,74,49},{74,58,74,60},{75,30,75,32},{75,42,75,42},{75,48,75,48},
	{75,58,75,60},{76,30,76,32},{76,42,76,43},{76,47,76,48},{76,58,76,60},{77,31,77,33},{77,44,77,46},{77,57,77,59},{78,31,78,33},{78,57,78,59},{79,31,79,33},{79,57,79,59},{80,32,80,34},{80,56,80,58},{81,12,81,18},{81,32,81,35},{81,55,81,58},{82,9,82,21},{82,33,82,36},{82,54,82,57},
	{83,8,83,11},{83,19,83,22},{83,34,83,37},{83,53,83,56},{84,7,84,9},{84,21,84,23},{84,35,84,38},{84,52,84,55},{85,6,85,7},{85,13,85,17},{85,23,85,24},{85,36,85,41},{85,49,85,54},{86,5,86,6},{86,11,86,12},{86,18,86,19},{86,24,86,25},{86,37,86,53},{87,4,87,5},{87,9,87,10},{87,20,87,21},{87,25,87,26},
	{87,39,87,51},{88,3,88,5},{88,8,88,8},{88,22,88,22},{88,25,88,27},{88,42,88,48},{89,3,89,4},{89,8,89,8},{89,22,89,22},{89,26,89,27},{90,3,90,4},{90,7,90,7},{90,23,90,23},{90,26,90,27},{91,2,91,3},{91,7,91,7},{91,23,91,23},{91,27,91,28},{92,2,92,3},{92,6,92,6},{92,24,92,24},{92,27,92,28},
	{93,2,93,3},{93,6,93,6},{93,24,93,24},{93,27,93,28},{94,2,94,3},{94,6,94,6},{94,24,94,24},{94,27,94,28},{95,2,95,3},{95,6,95,6},{95,24,95,24},{95,27,95,28},{96,2,96,3},{96,6,96,6},{96,24,96,24},{96,27,96,28},{97,2,97,3},{97,7,97,7},{97,23,97,23},{97,27,97,28},{98,3,98,4},{98,7,98,7},{98,23,98,23},
	{98,26,98,27},{99,3,99,4},{99,8,99,8},{99,22,99,22},{99,26,99,27},{100,3,100,5},{100,8,100,8},{100,22,100,22},{100,25,100,27},{101,4,101,5},{101,9,101,10},{101,20,101,21},{101,25,101,26},{102,5,102,6},{102,11,102,12},{102,18,102,19},{102,24,102,25},{103,6,103,7},{103,13,103,17},{103,23,103,24},{104,7,104,9},
	{104,21,104,23},{105,8,105,11},{105,19,105,22},{106,9,106,21},{107,12,107,18}
};

const uint8_t upm_stop_belts[149][4] PROGMEM  = {
	{43,33,43,34},{44,29,44,33},{45,26,45,29},{46,23,46,28},{47,19,47,22},{48,13,48,18},{49,11,49,19},{50,10,50,20},{50,45,50,45},{51,9,51,12},{51,18,51,21},{51,33,51,34},{51,46,51,46},{52,9,52,11},{52,19,52,21},{52,32,52,32},{52,47,52,47},{53,8,53,10},{53,20,53,22},{53,31,53,31},{53,48,53,48},{54,8,54,10},
	{54,20,54,22},{54,30,54,30},{54,49,54,49},{55,8,55,10},{55,15,55,15},{55,20,55,22},{55,29,55,30},{55,50,55,50},{56,8,56,10},{56,20,56,22},{56,27,56,29},{56,51,56,51},{57,8,57,10},{57,20,57,22},{57,26,57,26},{57,29,57,29},{57,51,57,51},{58,9,58,11},{58,19,58,21},{58,24,58,25},{58,29,58,29},{58,52,58,52},
	{59,9,59,12},{59,18,59,23},{59,29,59,29},{59,53,59,53},{60,10,60,21},{60,29,60,29},{61,11,61,19},{61,29,61,29},{62,10,62,10},{62,13,62,17},{62,19,62,19},{62,29,62,29},{63,10,63,10},{63,20,63,20},{63,30,63,30},{64,10,64,10},{64,20,64,20},{64,30,64,30},{65,10,65,10},{65,20,65,20},{65,30,65,30},{66,9,66,9},
	{66,20,66,20},{66,30,66,30},{67,9,67,9},{67,21,67,21},{67,30,67,30},{68,9,68,9},{68,13,68,17},{68,21,68,21},{69,8,69,8},{69,12,69,18},{69,21,69,21},{70,8,70,8},{70,11,70,13},{70,17,70,19},{70,22,70,22},{71,8,71,8},{71,10,71,12},{71,18,71,20},{71,22,71,22},{72,7,72,7},{72,10,72,11},{72,19,72,20},
	{72,22,72,22},{73,7,73,7},{73,10,73,11},{73,15,73,15},{73,19,73,20},{73,22,73,22},{74,7,74,7},{74,10,74,11},{74,19,74,20},{74,23,74,23},{75,7,75,7},{75,10,75,12},{75,18,75,20},{75,23,75,23},{76,6,76,6},{76,11,76,13},{76,17,76,19},{76,23,76,23},{77,6,77,6},{77,12,77,18},{77,23,77,23},{78,6,78,6},
    {78,13,78,17},{78,24,78,24},{79,5,79,5},{79,24,79,24},{80,5,80,5},{80,24,80,24},{81,5,81,5},{81,25,81,25},{82,4,82,4},{82,25,82,25},{83,4,83,4},{83,25,83,25},{84,4,84,4},{84,25,84,25},{85,4,85,4},{85,26,85,26},{86,3,86,3},{86,26,86,26},{87,3,87,3},{87,26,87,26},{88,3,88,3},{88,26,88,27},{89,3,89,3},{89,26,89,27},
	{90,3,90,3},{90,27,90,27},{91,2,91,3},{91,27,91,28},{92,2,92,3},{92,28,92,28},{93,2,93,2},{93,28,93,28},{94,2,94,2},{94,28,94,28},{95,2,95,2},{95,28,95,28},{96,2,96,2},{96,28,96,28},{97,2,97,2}
};

const uint8_t upm_forward_belts[162][4] PROGMEM  = {
	{44,30,44,32},{45,29,45,30},{48,24,48,25},{49,22,49,23},{50,21,50,21},{50,45,50,45},{51,19,51,20},{51,46,51,46},{52,18,52,18},{52,36,52,36},{52,47,52,47},{53,16,53,17},{53,35,53,35},{53,48,53,48},{54,14,54,15},{54,34,54,34},{54,49,54,49},{55,13,55,18},{55,30,55,30},{55,33,55,33},{55,50,55,50},{56,11,56,19},
	{56,30,56,30},{56,32,56,32},{56,51,56,51},{57,10,57,20},{57,30,57,31},{57,51,57,51},{58,9,58,12},{58,18,58,21},{58,29,58,30},{58,52,58,52},{59,9,59,11},{59,19,59,21},{59,28,59,28},{59,30,59,30},{59,53,59,53},{60,8,60,10},{60,20,60,22},{60,27,60,27},{60,30,60,30},{60,54,60,54},{61,8,61,10},{61,20,61,22},
	{61,26,61,26},{61,30,61,30},{61,55,61,55},{62,8,62,10},{62,15,62,15},{62,20,62,22},{62,25,62,25},{62,30,62,30},{62,56,62,56},{63,8,63,10},{63,20,63,22},{63,24,63,24},{63,30,63,30},{63,56,63,56},{64,8,64,10},{64,20,64,23},{64,30,64,30},{64,57,64,57},{65,9,65,11},{65,19,65,22},{65,30,65,30},{65,58,65,58},
	{66,9,66,12},{66,18,66,21},{66,30,66,30},{67,10,67,20},{67,30,67,30},{68,10,68,20},{68,30,68,30},{69,10,69,10},{69,13,69,17},{69,21,69,21},{69,30,69,30},{70,9,70,9},{70,13,70,17},{70,21,70,21},{70,30,70,30},{71,9,71,9},{71,12,71,18},{71,21,71,21},{71,30,71,30},{72,9,72,9},{72,11,72,13},{72,17,72,19},
	{72,22,72,22},{72,30,72,30},{73,8,73,8},{73,10,73,12},{73,18,73,20},{73,22,73,22},{73,30,73,30},{74,8,74,8},{74,10,74,11},{74,19,74,20},{74,22,74,22},{74,30,74,31},{75,8,75,8},{75,10,75,11},{75,15,75,15},{75,19,75,20},{75,23,75,23},{75,30,75,31},{76,7,76,7},{76,10,76,11},{76,19,76,20},{76,23,76,23},
	{76,30,76,31},{77,7,77,7},{77,10,77,12},{77,18,77,20},{77,23,77,23},{77,31,77,31},{78,7,78,7},{78,11,78,13},{78,17,78,19},{78,24,78,24},{78,31,78,31},{79,6,79,6},{79,12,79,18},{79,24,79,24},{79,31,79,31},{80,6,80,6},{80,13,80,17},{80,25,80,25},{81,5,81,5},{81,25,81,25},{82,5,82,5},{82,25,82,25},
	{83,5,83,5},{83,26,83,26},{84,4,84,4},{84,26,84,26},{85,4,85,4},{85,26,85,26},{86,4,86,4},{86,27,86,27},{87,3,87,3},{87,27,87,27},{88,3,88,3},{88,27,88,27},{89,3,89,3},{89,27,89,27},{90,3,90,3},{90,27,90,27},{91,2,91,3},{91,27,91,28},{92,2,92,2},{92,28,92,28},{93,2,93,2},{93,28,93,28},{94,2,94,2},{94,28,94,28},
	{95,2,95,2},{95,28,95,28},{96,2,96,2},{96,28,96,28},{97,2,97,2},{97,28,97,28}
};

const uint8_t upm_rewind_belts[168][4] PROGMEM  = {
	{43,25,43,35},{44,13,44,24},{45,11,45,19},{46,10,46,20},{47,9,47,12},{47,18,47,21},{48,9,48,11},{48,19,48,21},{49,8,49,10},{49,20,49,22},{50,8,50,10},{50,20,50,22},{50,45,50,45},{51,8,51,10},{51,15,51,15},{51,20,51,22},{51,46,51,46},{52,8,52,10},{52,20,52,22},{52,31,52,32},{52,47,52,47},{53,8,53,10},{53,20,53,22},{53,29,53,30},
	{53,48,53,48},{54,9,54,11},{54,19,54,21},{54,27,54,29},{54,49,54,49},{55,9,55,12},{55,18,55,21},{55,25,55,26},{55,29,55,29},{55,50,55,50},{56,10,56,20},{56,22,56,24},{56,29,56,29},{56,51,56,51},{57,10,57,21},{57,29,57,29},{57,51,57,51},{58,10,58,10},{58,13,58,20},{58,29,58,29},{58,52,58,52},{59,9,59,9},{59,20,59,20},{59,29,59,29},
	{59,53,59,53},{60,9,60,9},{60,21,60,21},{60,30,60,30},{60,54,60,54},{61,9,61,9},{61,21,61,21},{61,30,61,30},{61,55,61,55},{62,9,62,9},{62,21,62,21},{62,30,62,30},{62,56,62,56},{63,8,63,8},{63,21,63,21},{63,30,63,30},{63,56,63,56},{64,8,64,8},{64,22,64,22},{64,30,64,30},{64,57,64,57},{65,8,65,8},{65,13,65,17},{65,22,65,22},
	{65,30,65,30},{65,58,65,58},{66,8,66,8},{66,12,66,18},{66,22,66,22},{66,30,66,30},{66,58,66,58},{67,8,67,8},{67,11,67,13},{67,17,67,19},{67,22,67,22},{67,30,67,30},{68,7,68,7},{68,10,68,12},{68,18,68,20},{68,23,68,23},{68,30,68,30},{69,7,69,7},{69,10,69,11},{69,19,69,20},{69,23,69,23},{69,30,69,30},{70,7,70,7},{70,10,70,11},
	{70,15,70,15},{70,19,70,20},{70,23,70,23},{70,30,70,30},{71,7,71,7},{71,10,71,11},{71,19,71,20},{71,23,71,23},{71,30,71,30},{72,7,72,7},{72,10,72,12},{72,18,72,20},{72,23,72,23},{72,30,72,30},{73,6,73,6},{73,11,73,13},{73,17,73,19},{73,24,73,24},{73,30,73,30},{74,6,74,6},{74,12,74,18},{74,24,74,24},{74,30,74,30},{75,6,75,6},
	{75,13,75,17},{75,24,75,24},{75,30,75,30},{76,6,76,6},{76,24,76,24},{76,30,76,30},{77,5,77,5},{77,25,77,25},{78,5,78,5},{78,25,78,25},{79,5,79,5},{79,25,79,25},{80,5,80,5},{80,25,80,25},{81,5,81,5},{81,26,81,26},{82,4,82,4},{82,26,82,26},{83,4,83,4},{83,26,83,26},{84,4,84,4},{84,26,84,26},{85,4,85,4},{85,27,85,27},
	{86,3,86,3},{86,27,86,27},{87,3,87,3},{87,27,87,27},{88,3,88,3},{88,27,88,27},{89,3,89,3},{89,27,89,27},{90,3,90,3},{90,27,90,27},{91,2,91,2},{91,27,91,28},{92,2,92,2},{92,28,92,28},{93,2,93,2},{93,28,93,28},{94,2,94,2},{94,28,94,28},{95,2,95,2},{95,28,95,28},{96,2,96,2},{96,28,96,28},{97,2,97,2},{97,28,97,28}
};

void show_loading()
{
	disp1color_FillScreenbuff(0);
	show_upm_anim();
	disp1color_UpdateFromBuff();
}

void show_upm_anim()
{
	static uint8_t anim_inc = 3;
	uint8_t anim_invert[4] = {3,2,1,0};
	
	for (uint16_t i = 0; i < 292; i++) {
		oled_draw_line(
			pgm_read_byte(&upm_stop_anim[i][0]),
			pgm_read_byte(&upm_stop_anim[i][1]),
			pgm_read_byte(&upm_stop_anim[i][2]),
			pgm_read_byte(&upm_stop_anim[i][3])
		);
		
		if (((current.servo_real_mode != FORWARD_MODE && current.servo_real_mode != REWIND_MODE) || current.in_process == 1)  && i < 149) {
			oled_draw_line(
				pgm_read_byte(&upm_stop_belts[i][0]),
				pgm_read_byte(&upm_stop_belts[i][1]),
				pgm_read_byte(&upm_stop_belts[i][2]),
				pgm_read_byte(&upm_stop_belts[i][3])
			);
		} else if (current.servo_real_mode == FORWARD_MODE && i < 162) {
			oled_draw_line(
				pgm_read_byte(&upm_forward_belts[i][0]),
				pgm_read_byte(&upm_forward_belts[i][1]),
				pgm_read_byte(&upm_forward_belts[i][2]),
				pgm_read_byte(&upm_forward_belts[i][3])
			);
		} else if (current.servo_real_mode == REWIND_MODE && i < 168) {
			oled_draw_line(
				pgm_read_byte(&upm_rewind_belts[i][0]),
				pgm_read_byte(&upm_rewind_belts[i][1]),
				pgm_read_byte(&upm_rewind_belts[i][2]),
				pgm_read_byte(&upm_rewind_belts[i][3])
			);
		}
	}
	
	if (anim_inc == 3) {
		oled_draw_double_pixel(72, 34, 1);
		oled_draw_double_pixel(78, 36, 1);
		oled_draw_double_pixel(80, 38, 1);
		oled_draw_pixel(42, 30, 0);
		oled_draw_pixel(52, 30, 0);
		oled_draw_pixel(52, 40, 0);
		oled_draw_pixel(42, 40, 0);
		oled_draw_pixel(40, 35, 0);
		oled_draw_pixel(47, 28, 0);
		oled_draw_pixel(54, 35, 0);
		oled_draw_pixel(47, 42, 0);
	} else if (anim_inc == 2) {
		oled_draw_double_pixel(83, 44, 1);
		oled_draw_double_pixel(81, 50, 1);
		oled_draw_double_pixel(79, 52, 1);
		oled_draw_pixel(48, 28, 0);
		oled_draw_pixel(53, 31, 0);
		oled_draw_pixel(54, 36, 0);
		oled_draw_pixel(51, 41, 0);
		oled_draw_pixel(46, 42, 0);
		oled_draw_pixel(41, 39, 0);
		oled_draw_pixel(40, 34, 0);
		oled_draw_pixel(43, 29, 0);
		oled_draw_pixel(48, 28, 0);
	} else if (anim_inc == 1) {
		oled_draw_double_pixel(73, 55, 1);
		oled_draw_double_pixel(67, 53, 1);
		oled_draw_double_pixel(65, 51, 1);
		oled_draw_pixel(44, 28, 0);
		oled_draw_pixel(49, 28, 0);
		oled_draw_pixel(54, 32, 0);
		oled_draw_pixel(54, 37, 0);
		oled_draw_pixel(50, 42, 0);
		oled_draw_pixel(40, 38, 0);
		oled_draw_pixel(40, 33, 0);
		oled_draw_pixel(45, 42, 0);
	} else if (anim_inc == 0) {
		oled_draw_double_pixel(62, 45, 1);
		oled_draw_double_pixel(64, 39, 1);
		oled_draw_double_pixel(66, 37, 1);
		oled_draw_pixel(46, 28, 0);
		oled_draw_pixel(51, 29, 0);
		oled_draw_pixel(54, 34, 0);
		oled_draw_pixel(53, 39, 0);
		oled_draw_pixel(48, 42, 0);
		oled_draw_pixel(43, 41, 0);
		oled_draw_pixel(40, 36, 0);
		oled_draw_pixel(41, 31, 0);
	}
	
	static uint8_t up_down = 1;
	
	if (current.reel_speed_left == 0 && current.reel_speed_right == 0) {
		if (current.servo_real_mode != REWIND_MODE) {
			up_down = 1;
		} else {
			up_down = 0;
		}
	}
	
	if (current.reel_speed_left > 0) {
		if (up_down == 1) {
			oled_draw_reel(30, 15, anim_inc);
		} else {
			oled_draw_reel(30, 15, anim_invert[anim_inc]);
		}

	} else {
		oled_draw_reel(30, 15, 0);
	}

	if (current.reel_speed_right > 0) {
		if (up_down == 1) {
			oled_draw_reel(94, 15, anim_inc);
		} else {
			oled_draw_reel(94, 15, anim_invert[anim_inc]);
		}
	} else {
		oled_draw_reel(94, 15, 0);
	}

	anim_inc++;
	if (anim_inc > 3){
		anim_inc = 0;
	}
}
